library(stringr)
library(stringr)
library(readxl)
library(dplyr)
loadMonth = function(myyear, mymonth, startDate) {
fileName = paste0(myyear,"-", str_pad(mymonth, 2, "left", "0"), ".xlsm")
cat(fileName)
x = read_excel(fileName)
}
myyear=2021
mymonth=4
fileName = paste0(myyear,"-", str_pad(mymonth, 2, "left", "0"), ".xlsm")
cat(fileName)
x = read_excel(fileName)
names(x)
names(x)[3] = "a"
names(x)
names(x)[3:] = "a"
dates = startDate + days(x=seq.int(0,weeks*7-1))
library(lubridate)
startDate=ymd("2021-03-29")
View(x)
dates = startDate + days(x=seq.int(0,weeks*7-1))
weeks=4
dates = startDate + days(x=seq.int(0,weeks*7-1))
dates
weeks=5
dates = startDate + days(x=seq.int(0,weeks*7-1))
names(x)[3:length(names(x))] = dates
x = read_excel(fileName)
names(x)[2:length(names(x))] = dates
names(x)
fileName = paste0(myyear,"-", str_pad(mymonth, 2, "left", "0"), ".xlsm")
x = read_excel(fileName)
length(names(x))
names(x)[3:length(names(x))]
names(x)[2:length(names(x))]
names(x)[3:length(names(x))] = dates
library(purrr)
dates = keep(dates, isWeekday)
isWeekday = function(x) {
return !(wday(x, label=TRUE) %in% c("Sat", "Sun"))
}
dates = startDate + days(x=seq.int(0,weeks*7-1))
isWeekday = function(x) {
return !(wday(x, label=TRUE) %in% c("Sat", "Sun"))
}
isWeekday = function(x) {
return !(wday(x, label=TRUE) %in% c("Sat", "Sun"))
}
isWeekday = function(x) {
return (!wday(x, label=TRUE) %in% c("Sat", "Sun"))
}
dates = startDate + days(x=seq.int(0,weeks*7-1))
dates = keep(dates, isWeekday)
dates
names(x)[3:length(names(x))] = dates
x
library(tidyr)
dates[3:]
dates[3:NA]
dates[3:0]
x %>% pivot_longer(cols=3:length(dates)+3)
x %>% pivot_longer(cols=3:length(dates)-3)
3:length(dates)-3
3:10
x %>% pivot_longer(cols=3:(length(dates)-3))
x %>% pivot_longer(cols=3:length(dates))
x %>% pivot_longer(cols=1:length(dates)+3)
1:length(dates)+3
x %>% pivot_longer(cols=1:length(dates)+2)
x %>% pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity")
x %>% pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>% mutate(date = as.Date(date))
as.Date(18715)
Date(18715)
as.Date(18715)
format(dates)
names(x)[3:length(names(x))] = format(dates)
x %>% pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>% mutate(date = as.Date(date))
return x %>%
pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>%
mutate(
date = as.Date(date),
smo = recode(smo,
`Neil Anderson` = "NA")
)
x %>%
pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>%
mutate(
date = as.Date(date),
smo = recode(smo,
`Neil Anderson` = "NA")
)
x %>%
pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>%
mutate(
date = as.Date(date),
smo = recode(smo,
`Neil Anderson` = "NA",
`Alan Barber` = "AB",
`Peter Bergin` = "PB",
`Alison Charleston` = "AC",
`Nicholas Child` = "NC",
`Richard Frith` = "RF",
`Rosamund Hill` = "RH",
`David Hutchinson` = "DH",
`Dean Kilfoyle` = "DK",
`Jennifer Pereira` = "JP",
`Richard Roxburgh` = "RR",
`Mark Simpson` = "MS",
`Barry Snow` = "BS",
`Elizabeth Walker` = "ElW",
`Edward Wong` = "EdW",
`Ernie Willoughby` = "ErW",
`Julian Bauer` = "JB",
`Justin Kao` = "JK",
`Pyari Bose` = "PyB",
`Viswas Dayal` = "VD",
`Sunayana Sasikumar` = "SS",
`David McAuley` = "DM",
`Petina Newton` = "PN",
`Suzanne Davis` = "SD",
`Lalit Kalra` = "LK",
`Lalit Kalra or Adele McMahon` = "AM",
`Adele McMahon` = "AM",
`Suzanne Davis` = "SD",
)
)
View(x)
source('C:/code/roster/rosters/import.R')
loadMonth(2021,4,"2021-03-29",5)
roster = loadMonth(2021,4,"2021-03-29",5)
roster = rbind(roster, loadMonth(2021,5,"2021-05-03",4))
roster = loadMonth(2021,4,"2021-03-29",5)
myyear=2021
mymonth=4
startDate="2021-0-29"
roster = loadMonth(2021,4,"2021-03-29",5)
fileName = paste0(myyear,"-", str_pad(mymonth, 2, "left", "0"), ".xlsm")
x = read_excel(fileName)
dates = as.Date(startDate) + days(x=seq.int(0,weeks*7-1))
roster = loadMonth(2021,4,ymd("2021-03-29"),5)
roster = rbind(roster, loadMonth(2021,5,"2021-05-03",4))
roster = loadMonth(2021,4,ymd("2021-03-29"),5)
roster = rbind(roster, loadMonth(2021,5,"2021-05-03",4))
source('C:/code/roster/rosters/import.R')
roster = loadMonth(2021,4,ymd("2021-03-29"),5)
roster = rbind(roster, loadMonth(2021,5,"2021-05-03",4))
loadMonth(2021,5,"2021-05-03",4)
roster = loadMonth(2021,4,ymd("2021-03-29"),5)
roster = rbind(roster, loadMonth(2021,5,ymd("2021-05-03"),4))
View(roster)
source('C:/code/roster/rosters/import.R')
View(roster)
source('C:/code/roster/rosters/import.R')
View(roster)
View(roster)
source('C:/code/roster/rosters/import.R')
roster %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% select(smo=smo1, activity=activity1, everything())
y = x %>%
pivot_longer(cols=1:length(dates)+2, names_to="date", values_to="activity") %>%
mutate(
date = as.Date(date),
smo = recode(smo,
`Neil Anderson` = "NA",
`Alan Barber` = "AB",
`Peter Bergin` = "PB",
`Alison Charleston` = "AC",
`Nicholas Child` = "NC",
`Richard Frith` = "RF",
`Rosamund Hill` = "RH",
`David Hutchinson` = "DH",
`Dean Kilfoyle` = "DK",
`Jennifer Pereira` = "JP",
`Richard Roxburgh` = "RR",
`Mark Simpson` = "MS",
`Barry Snow` = "BS",
`Elizabeth Walker` = "ElW",
`Edward Wong` = "EdW",
`Ernie Willoughby` = "ErW",
`Julian Bauer` = "JB",
`Justin Kao` = "JK",
`Pyari Bose` = "PyB",
`Viswas Dayal` = "VD",
`Sunayana Sasikumar` = "SS",
`David McAuley` = "DM",
`Petina Newton` = "PN",
`Petina Newton (Neuropsychologist)` = "PN",
`Suzanne Davis` = "SD",
`Lalit Kalra` = "LK",
`Lalit Kalra or Adele McMahon` = "AM",
`Adele McMahon` = "AM",
`Suzanne Davis` = "SD",
)
) %>%
filter(!is.na(activity))
roster
roster %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity))
roster %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% filter(activity1 == "OnCall                                                                                                                                ")
roster %>% rowwise() %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% filter(activity1 == "OnCall                                                                                                                                ")
roster %>% rowwise() %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity))
roster %>%  mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity))
roster %>% filter(smo=="OnCall")
roster %>%  mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% filter(smo=="OnCall")
roster %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% select(date, time, smo=smo1, activity=activity1)
z= roster %>% mutate(smo1 = ifelse(smo == "OnCall", activity, smo), activity1 = ifelse(smo == "OnCall", smo, activity)) %>% select(date, time, smo=smo1, activity=activity1)
z=filter(activity=="OnCall")
z %>% filter(activity=="OnCall")
source('C:/code/roster/rosters/import.R')
roster %>% filter(activity=="OnCall")
library(jsonlite)
toJSON(roster)
jsonlite::write_json(roster, "roster")
source('C:/code/roster/rosters/import.R')
source('C:/code/roster/rosters/import.R')
source('C:/code/roster/rosters/import.R')
